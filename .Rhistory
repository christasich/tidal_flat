scale_y_continuous(limits = c(0, 1))
ggplotly(p, tooltip = "all")
p = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0, 1))
ggplotly(p, tooltip = "all")
p = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 14400, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0, 1))
ggplotly(p, tooltip = "all")
slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 14400, .align="center-right", .partial = TRUE))
slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 14400, .align="center-right", .partial = TRUE)
slide_dbl(plot_data$SSC, ~ mean(.,na.rm = TRUE), .size = 14400, .align="center-right", .partial = TRUE))
slide_dbl(plot_data$SSC, ~ mean(.,na.rm = TRUE), .size = 14400, .align="center-right", .partial = TRUE)))
slide_dbl(plot_data$SSC, ~ mean(.,na.rm = TRUE), .size = 14400, .align="center-right", .partial = TRUE)
x = slide_dbl(plot_data$SSC, ~ mean(.,na.rm = TRUE), .size = 14400, .align="center-right", .partial = TRUE)
length(x)
plot_data = sample_frac(data, 0.05) %>%
arrange(Datetime)
plot_data = data %>%
arrange(Datetime) %>%
sample_frac(data, 0.05)
plot_data = data %>%
arrange(Datetime) %>%
sample_frac(0.05)
type(data)
class(data)
plot_data = data %>%
index(Datetime) %>%
sample_frac(0.05)
plot_data = data %>%
as.tsibble(index = Datetime) %>%
sample_frac(0.05)
plot_data = data %>%
as_tsibble(index = Datetime) %>%
sample_frac(0.05)
plot_data = data %>%
as_tsibble(index = Datetime) %>%
order(Datetime)
plot_data = data %>%
sample_frac(0.05, replace = FALSE)
p = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 14400, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0, 1))
ggplotly(p, tooltip = "all")
plot_data = data %>%
sample_frac(0.1, replace = FALSE)
p = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 14400, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0, 1))
ggplotly(p, tooltip = "all")
plot_data = data %>%
sample_frac(0.5, replace = FALSE)
p = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 14400, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0, 1))
ggplotly(p, tooltip = "all")
p = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 14400, .align="center-right", .partial = TRUE)), color = "red")
ggplotly(p, tooltip = "all")
p = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red")
ggplotly(p)
p = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 144, .align="center-right", .partial = TRUE)), color = "red")
ggplotly(p)
p = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 100, .align="center-right", .partial = TRUE)), color = "red")
ggplotly(p)
p = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red")
ggplotly(p)
p = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red") +
continuous_scale(limts = c(0,1))
ggplotly(p)
p = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0,1))
ggplotly(p)
View(data)
data = full_join(tides, ssc, by = "Datetime") %>%
full_join(subset(combined_high_low_tides, select = c(Datetime, high_tide, low_tide, amp, high_low_cycle)), by = "Datetime") %>%
full_join(subset(combined_spring_neap_tides, select = c(Datetime, spring_neap_cycle, spring_time, neap_time)), by = "Datetime") %>%
arrange(Datetime) %>%
as_tsibble(index = Datetime) %>%
mutate(last_high_tide = na.locf(high_tide, na.rm = FALSE)) %>%
mutate(last_low_tide = na.locf(low_tide, na.rm = FALSE)) %>%
mutate(last_amp = na.locf(amp, na.rm = FALSE)) %>%
mutate(month = month(Datetime, label = TRUE)) %>%
mutate(week = week(Datetime)) %>%
mutate(spring_time = na.locf(spring_time, na.rm = FALSE)) %>%
mutate(neap_time = na.locf(neap_time, na.rm = FALSE)) %>%
mutate(dt_spring = as.numeric(Datetime - spring_time, units = "hours")) %>%
mutate(dt_neap = as.numeric(Datetime - neap_time, units = "hours")) %>%
filter(SSC != "NA")
p = ggplot(plot_data, aes(y = SSC, x = dt_neap)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0,1))
ggplotly(p)
View(data)
View(data)
data = full_join(tides, ssc, by = "Datetime") %>%
full_join(subset(combined_high_low_tides, select = c(Datetime, high_tide, low_tide, amp, high_low_cycle)), by = "Datetime") %>%
full_join(subset(combined_spring_neap_tides, select = c(Datetime, spring_neap_cycle, spring_time, neap_time)), by = "Datetime") %>%
arrange(Datetime) %>%
as_tsibble(index = Datetime) %>%
mutate(last_high_tide = na.locf(high_tide, na.rm = FALSE)) %>%
mutate(last_low_tide = na.locf(low_tide, na.rm = FALSE)) %>%
mutate(last_amp = na.locf(amp, na.rm = FALSE)) %>%
mutate(month = month(Datetime, label = TRUE)) %>%
mutate(week = week(Datetime)) %>%
mutate(spring_time = na.locf(spring_time, na.rm = FALSE)) %>%
mutate(neap_time = na.locf(neap_time, na.rm = FALSE)) %>%
mutate(dt_spring = as.numeric(Datetime - spring_time, units = "hours")) %>%
mutate(dt_neap = as.numeric(Datetime - neap_time, units = "hours")) %>%
filter(SSC != "NA")
View(data)
library(lubridate)
library(tidyverse)
library(tsibble)
library(oce)
library(gridExtra)
library(xts)
# Set working dir
setwd("C:/Projects/tidal_flat_0d")
# Read data from csv
pressure = read.csv("data/interim/sutarkhali_pressure.csv")
ssc = read.csv("data/interim/sutarkhali_ssc.csv")
# Filter NaNs and normalize by mean
pressure = pressure %>%
filter(Pressure != "NaN") %>%
filter(Datetime != "NA") %>%
mutate(Pressure = Pressure - mean(Pressure)) %>%
mutate(Datetime = mdy_hms(Datetime, tz = "Asia/Dhaka")) %>%
as_tsibble(index = Datetime)
ssc = ssc %>%
mutate(Datetime = mdy_hms(Datetime, tz = "Asia/Dhaka")) %>%
mutate(Datetime = round_date(Datetime, unit = "1 minute")) %>%
as_tsibble(index = Datetime)
tides.sl = as.sealevel(elevation = pressure$Pressure, time = pressure$Datetime)
mod = tidem(t = tides.sl)
index = seq.POSIXt(pressure$Datetime[1], tail(ssc$Datetime,1), by = "min")
tides = tibble(Datetime = index) %>%
full_join(pressure, by = "Datetime") %>%
as_tsibble(index = Datetime)
tides$Estimated.Pressure = predict(mod, newdata=tides$Datetime)
# Find high and low tides
window_size = 3 # in hours
high_tides = tides %>%
filter(Estimated.Pressure > lead(Estimated.Pressure) & Estimated.Pressure > lag(Estimated.Pressure)) %>%
mutate(high_tide = Estimated.Pressure) %>%
mutate(high_low_cycle = "high")
low_tides = tides %>%
filter(Estimated.Pressure < lead(Estimated.Pressure) & Estimated.Pressure < lag(Estimated.Pressure)) %>%
mutate(low_tide = Estimated.Pressure) %>%
mutate(high_low_cycle = "low")
combined_high_low_tides = as_tibble(bind_rows(high_tides, low_tides)) %>%
arrange(Datetime) %>%
mutate(amp = abs(Estimated.Pressure - lag(Estimated.Pressure, 1)))
# Find spring and neap tides
spring_tides = combined_high_low_tides %>%
mutate(ma = slide_dbl(amp, ~ max(.,na.rm = TRUE), .size = 10, .align="center-right", .partial = TRUE)) %>%
mutate(dt = lead(Datetime) - Datetime) %>%
mutate(spring_neap_cycle = "spring") %>%
mutate(spring_time = Datetime) %>%
filter(ma == amp) %>%
distinct()
neap_tides = combined_high_low_tides %>%
mutate(ma = slide_dbl(amp, ~ min(.,na.rm = TRUE), .size = 10, .align="center-right", .partial = TRUE)) %>%
mutate(dt = lead(Datetime) - Datetime) %>%
mutate(spring_neap_cycle = "neap") %>%
mutate(neap_time = Datetime) %>%
filter(ma == amp) %>%
distinct()
combined_spring_neap_tides = as_tibble(bind_rows(spring_tides, neap_tides)) %>%
arrange(Datetime) %>%
subset(select = c(Datetime, Pressure, Estimated.Pressure, amp, spring_neap_cycle, spring_time, neap_time))
data = full_join(tides, ssc, by = "Datetime") %>%
full_join(subset(combined_high_low_tides, select = c(Datetime, high_tide, low_tide, amp, high_low_cycle)), by = "Datetime") %>%
full_join(subset(combined_spring_neap_tides, select = c(Datetime, spring_neap_cycle, spring_time, neap_time)), by = "Datetime") %>%
arrange(Datetime) %>%
as_tsibble(index = Datetime) %>%
mutate(last_high_tide = na.locf(high_tide, na.rm = FALSE)) %>%
mutate(last_low_tide = na.locf(low_tide, na.rm = FALSE)) %>%
mutate(last_amp = na.locf(amp, na.rm = FALSE)) %>%
mutate(month = month(Datetime, label = TRUE)) %>%
mutate(week = week(Datetime)) %>%
mutate(spring_time = na.locf(spring_time, na.rm = FALSE)) %>%
mutate(neap_time = na.locf(neap_time, na.rm = FALSE)) %>%
mutate(dt_spring = as.numeric(Datetime - spring_time, units = "hours")) %>%
mutate(dt_neap = as.numeric(Datetime - neap_time, units = "hours")) %>%
filter(SSC != "NA")
# boxes for plotting spring neap
# spring_box = spring_tides %>%
#   mutate(xmin = (Datetime + dt) - days(2)) %>%
#   mutate(xmax = (Datetime + dt) + days(2)) %>%
#   subset(select = c(xmin, xmax)) %>%
#   mutate(ymin = -Inf) %>%
#   mutate(ymax = Inf)
#
# neap_box = neap_tides %>%
#   mutate(xmin = (Datetime + dt) - days(2)) %>%
#   mutate(xmax = (Datetime + dt) + days(2)) %>%
#   subset(select = c(xmin, xmax)) %>%
#   mutate(ymin = -Inf) %>%
#   mutate(ymax = Inf)
#
#
# start = as.POSIXct('2015-05-1')
# stop = as.POSIXct('2015-5-30')
#
# plot_data = tides %>%
#   filter(Datetime >= start, Datetime <= stop) %>%
#   sample_frac(0.2)
#
# ggplot() +
#   geom_point(data = plot_data, aes(x = Datetime, y = Pressure), size = 1, alpha = 0.1) +
#   geom_rect(data=spring_box, aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
#             color="red",
#             fill="red",
#             alpha=0.3) +
#   geom_rect(data=neap_box, aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
#             color="blue",
#             fill="blue",
#             alpha=0.3) +
#   scale_x_datetime(expand = c(0, 0), limits = c(start, stop)) +
#   scale_y_continuous(limits = c(-3, 3)) +
#   theme_bw()
#
# data = data %>%
#   filter(SSC != "NA")
#
# ggplot(data = data) +
#   geom_boxplot(aes(y = SSC, x = week, group = week))
#
# ggplot(data = data) +
#   geom_boxplot(aes(y = SSC, x = round(dt_spring,0), group = round(dt_spring,0))) +
#   scale_y_continuous(limits = c(0, 0.5))
# Plot SSC vs
plot_data = data %>%
sample_frac(0.5, replace = FALSE)
p = ggplot(plot_data, aes(y = SSC, x = dt_neap)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0,1))
ggplotly(p)
plot_data = data %>%
sample_frac(0.05, replace = FALSE)
p = ggplot(plot_data, aes(y = SSC, x = dt_neap)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0,1))
ggplotly(p)
View(data)
data = full_join(tides, ssc, by = "Datetime") %>%
full_join(subset(combined_high_low_tides, select = c(Datetime, high_tide, low_tide, amp, high_low_cycle)), by = "Datetime") %>%
full_join(subset(combined_spring_neap_tides, select = c(Datetime, spring_neap_cycle, spring_time, neap_time)), by = "Datetime") %>%
arrange(Datetime) %>%
as_tsibble(index = Datetime) %>%
mutate(high_tide = na.locf(high_tide, na.rm = FALSE)) %>%
mutate(low_tide = na.locf(low_tide, na.rm = FALSE)) %>%
mutate(amp = na.locf(amp, na.rm = FALSE)) %>%
mutate(month = month(Datetime, label = TRUE)) %>%
mutate(week = week(Datetime)) %>%
mutate(spring_time = na.locf(spring_time, na.rm = FALSE)) %>%
mutate(neap_time = na.locf(neap_time, na.rm = FALSE)) %>%
mutate(dt_spring = as.numeric(Datetime - spring_time, units = "hours")) %>%
mutate(dt_neap = as.numeric(Datetime - neap_time, units = "hours")) %>%
filter(SSC != "NA")
View(data)
p = ggplot(plot_data, aes(y = SSC, x = high_tide)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0,1))
ggplotly(p)
plot_data = data %>%
sample_frac(0.05, replace = FALSE)
p = ggplot(plot_data, aes(y = SSC, x = high_tide)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0,1))
ggplotly(p)
p = ggplot(plot_data, aes(y = SSC, x = low_tide)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0,1))
ggplotly(p)
p = ggplot(plot_data, aes(y = SSC, x = week)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0,1))
ggplotly(p)
ggplot(plot_data, aes(y = SSC, x = round(dt_spring,0)) +
geom_boxplot(group = round(dt_spring,0))) +
scale_y_continuous(limits = c(0, 0.5))
View(plot_data)
ggplot(plot_data, aes(y = SSC, x = round(dt_spring,0)) +
geom_boxplot(group = round(dt_spring,0))) +
scale_y_continuous(limits = c(0, 0.5))
ggplot(plot_data) +
geom_boxplot(aes(y = SSC, x = round(dt_spring,0), group = round(dt_spring,0))) +
scale_y_continuous(limits = c(0, 0.5))
ggplot(plot_data) +
geom_boxplot(aes(y = SSC, x = round(dt_spring,0), group = round(dt_spring/24,0))) +
scale_y_continuous(limits = c(0, 0.5))
ggplot(plot_data) +
geom_boxplot(aes(y = SSC, x = round(dt_spring/24,0), group = round(dt_spring/24,0))) +
scale_y_continuous(limits = c(0, 0.5))
p3 = ggplot(plot_data) +
geom_boxplot(aes(y = SSC, x = week, group = week)) +
scale_y_continuous(limits = c(0, 0.5))
ggplotly(p3)
p1 = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0,1))
ggplotly(p1)
p1 = ggplot(plot_data, aes(y = SSC, x = dt_spring)) +
geom_point(alpha = 0.1) +
geom_smooth() +
#  geom_line(aes(y = slide_dbl(SSC, ~ mean(.,na.rm = TRUE), .size = 1440, .align="center-right", .partial = TRUE)), color = "red") +
scale_y_continuous(limits = c(0,1))
ggplotly(p1)
p3 = ggplot(plot_data) +
geom_boxplot(aes(y = SSC, x = week, group = week)) +
scale_y_continuous(limits = c(0, 0.5))
ggplotly(p3)
p3 = ggplot(plot_data) +
geom_boxplot(aes(y = SSC, x = week, group = week)) +
scale_y_continuous(limits = c(0, 0.5)) +
scale_x_continuous(breaks = seq(0, 52, 8))
ggplotly(p3)
p3 = ggplot(plot_data) +
geom_boxplot(aes(y = SSC, x = week, group = week)) +
geom_smooth(aes(x = week, y = SSC)) +
scale_y_continuous(limits = c(0, 0.5)) +
scale_x_continuous(breaks = seq(0, 52, 8))
ggplotly(p3)
head(plot_data)
head(data)
ggplot(data, aes(x = month, y - SSC)) + geom_smooth() + scale_x_continuous(labels = month.abb)
ggplot(data, aes(x = month, y = SSC)) + geom_smooth() + scale_x_continuous(breaks = 1:12, labels = month.abb)
ggplot(data, aes(x = month, y = SSC)) + geom_smooth()
ggplot(data, aes(x = month, y = SSC)) + geom_smooth(na.rm = TRUE)
glimpse(data)
ggplot(data, aes(x = as_numeric(month), y = SSC)) + geom_smooth(na.rm = TRUE)
ggplot(data, aes(x = as.numeric(month), y = SSC)) + geom_smooth(na.rm = TRUE)
ggplot(data, aes(x = as.numeric(month), y = SSC)) + geom_smooth(na.rm = TRUE) + scale_x_continuous(breaks = 1:12, labels = month.abb)
data %>% mutate(year = year(Datetime)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup() %>% mutate(date = make_date(year, as.integer(month), day = 15)) %>% ggplot(aes(x = date, y = SSC)) + geom_smooth()
data %>% filter(!is.na(Datetime)) %>% mutate(year = year(Datetime)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup() %>% mutate(date = make_date(year, as.integer(month), day = 15)) %>% ggplot(aes(x = date, y = SSC)) + geom_smooth()
data %>% filter(!is.na(Datetime)) %>% mutate(year = year(Datetime)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup() %>% head()
data %>% filter(!is.na(Datetime)) %>% mutate(year = year(Datetime)) %>% head()
data %>% filter(!is.na(Datetime)) %>% mutate(year = year(Datetime)) %>% glimpse()
data %>% mutate(year = year(Datetime), month = as.integer(month)) %>% glimpse()
data %>% mutate(year = year(Datetime), month = as.integer(month)) %>% glimpse() %>% group_by(year, month)
data %>% mutate(year = year(Datetime), month = as.integer(month)) %>% glimpse() %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup()
data %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup()
data %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup() %>% mutate(date = make_date(year = year, month = month, day = 15))
data %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup() %>% mutate(date = make_date(year = year, month = month, day = 15)) %>% ggplot(aes(x = date, y = SSC)) + geom_smooth()
data %>% filter(SSC > 0) %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup() %>% mutate(date = make_date(year = year, month = month, day = 15)) %>% ggplot(aes(x = date, y = SSC)) + geom_smooth()
data %>% filter(SSC > 0) %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup() %>% mutate(date = make_date(year = year, month = month, day = 15)) %>% ggplot(aes(x = date, y = SSC)) + geom_smooth() + geom_point(alpha = .01)
data %>% filter(SSC > 0) %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup() %>% mutate(date = make_date(year = year, month = month, day = 15)) %>% ggplot(aes(x = date, y = SSC)) + geom_smooth() + geom_point(alpha = .3)
data %>% filter(SSC >= 0) %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup() %>% mutate(date = make_date(year = year, month = month, day = 15)) %>% dim()
data %>% filter(SSC >= 0) %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup()  %>% dim()
data %>% filter(SSC >= 0) %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup()  %>% head()
data %>% as_tibble() %>% filter(SSC >= 0) %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup()  %>% head()
data %>% as_tibble() %>% filter(SSC >= 0) %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup()  %>% mutate(date = make_date(year, month, 15)) %>% ggplot(aes(x = date, y = SSC)) + geom_smooth() + geom_point(alpha = 0.3)
data %>% as_tibble() %>% filter(SSC >= 0) %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, month) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup()  %>% mutate(date = make_date(year, month, 15)) %>% ggplot(aes(x = month, y = SSC)) + geom_smooth() + geom_point(alpha = 0.3) + scale_x_continuous(breaks = 1:12, labels = month.abb)
data %>% as_tibble() %>% filter(SSC >= 0) %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, weeek) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup()  ggplot(aes(x = week, y = SSC)) + geom_smooth() + geom_point(alpha = 0.3) + scale_x_continuous(breaks = seq(0, 52, 8))
data %>% as_tibble() %>% filter(SSC >= 0) %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, weeek) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup()  %>% ggplot(aes(x = week, y = SSC)) + geom_smooth() + geom_point(alpha = 0.3) + scale_x_continuous(breaks = seq(0, 52, 8))
data %>% as_tibble() %>% filter(SSC >= 0) %>% mutate(year = year(Datetime), month = as.integer(month)) %>% group_by(year, week) %>% summarize(SSC = mean(SSC, na.rm = TRUE)) %>% ungroup()  %>% ggplot(aes(x = week, y = SSC)) + geom_smooth() + geom_point(alpha = 0.3) + scale_x_continuous(breaks = seq(0, 52, 8))
data %>%
as_tibble() %>%
filter(SSC >= 0) %>%
mutate(year = year(Datetime), month = as.integer(month)) %>%
group_by(year, week) %>%
summarize(SSC = mean(SSC, na.rm = TRUE)) %>%
ungroup()  %>%
ggplot(aes(x = week, y = SSC)) +
geom_smooth() + geom_point(alpha = 0.3) +
scale_x_continuous(breaks = seq(0, 52, 8))
data %>%
as_tibble() %>%
mutate(year = year(Datetime), month = as.integer(month)) %>%
group_by(year, week) %>%
summarize(SSC = mean(SSC, na.rm = TRUE)) %>%
ungroup()  %>%
ggplot(aes(x = week, y = SSC)) +
geom_smooth() + geom_point(alpha = 0.3) +
scale_x_continuous(breaks = seq(0, 52, 8))
data %>%
as_tibble() %>%
mutate(year = year(Datetime), month = as.integer(month)) %>%
group_by(year, week) %>%
summarize(SSC = mean(SSC, na.rm = TRUE)) %>%
ungroup()  %>%
ggplot(aes(x = week, y = SSC)) +
geom_smooth() + geom_point(alpha = 0.3) +
scale_x_continuous(breaks = seq(0, 52, 8))
filter(data, SSC < 0)
data %>%
as_tibble() %>%
mutate(year = year(Datetime), month = as.integer(month)) %>%
group_by(year, week) %>%
summarize(SSC = mean(SSC, na.rm = TRUE))
x = data %>%
as_tibble() %>%
mutate(year = year(Datetime), month = as.integer(month)) %>%
group_by(year, week) %>%
summarize(SSC = mean(SSC, na.rm = TRUE))
View(x)
x = data %>%
as_tibble() %>%
mutate(year = year(Datetime), month = as.integer(month)) %>%
group_by(year, week) %>%
summarize(SSC = mean(SSC, na.rm = TRUE)) %>%
ungroup()
View(x)
x = data %>%
as_tibble() %>%
mutate(year = year(Datetime), month = as.integer(month)) %>%
group_by(year, week) %>%
summarize(SSC = mean(SSC, na.rm = TRUE)) %>%
ggplot(aes(x = week, y = SSC)) +
geom_smooth() +
geom_point(alpha = 0.3) +
scale_x_continuous(breaks = seq(0, 52, 8))
View(x)
data %>%
as_tibble() %>%
mutate(year = year(Datetime), month = as.integer(month)) %>%
group_by(year, week) %>%
summarize(SSC = mean(SSC, na.rm = TRUE)) %>%
ungroup()  %>%
ggplot(aes(x = week, y = SSC)) +
geom_smooth() +
geom_point(alpha = 0.3) +
scale_x_continuous(breaks = seq(0, 52, 8))
loess_fx = data %>%
as_tibble() %>%
mutate(year = year(Datetime), month = as.integer(month)) %>%
group_by(year, week) %>%
summarize(SSC = mean(SSC, na.rm = TRUE)) %>%
ungroup()
View(loess_fx)
View(loess_fx)
loess_fx = data %>%
as_tibble() %>%
mutate(year = year(Datetime), month = as.integer(month)) %>%
group_by(year, week) %>%
summarize(SSC = mean(SSC, na.rm = TRUE)) %>%
ungroup() %>%
loess(SSC ~ week)
data_by_week = data %>%
as_tibble() %>%
mutate(year = year(Datetime), month = as.integer(month)) %>%
group_by(year, week) %>%
summarize(SSC = mean(SSC, na.rm = TRUE)) %>%
ungroup()
loess_mod = (SSC ~ week, data = data_by_week)
loess_mod = (SSC ~ week, data = data_by_week)
loess_mod = (SSC ~ week, data_by_week)
loess_mod = (SSC ~ week), data_by_week)
loess_mod = loess(SSC ~ week, data_by_week)
View(loess_mod)
out_ssc = data_by_week$week
View(data_by_week)
out_ssc = seq(1,52,1)
seq(1,52,1)
seq(1,52)
out_ssc = tbl_df(week = seq(1,52))
out_ssc = tbl_df("week" = seq(1,52))
out_ssc = tbl_df("week" = seq(1,52))
out_ssc = data.frame("week" = seq(1,52))
View(out_ssc)
out_ssc = tibble("week" = seq(1,52))
out_data = tibble("week" = seq(1,52)) %>%
out_ssc$ssc = predict(loess_mod)
out_data = tibble("week" = seq(1,52)) %>%
out_data$ssc = predict(loess_mod)
out_data = tibble("week" = seq(1,52))
out_data$ssc = predict(loess_mod, newdata = out_data$week)
View(out_data)
write.csv(out_data)
help(write.csv)
write.csv(out_data, "./data/processed/ssc_by_week,csv")
write.csv(out_data, "./data/processed/ssc_by_week.csv")
out_data = tibble("week" = as.numeric(seq(1,52)))
out_data$ssc = predict(loess_mod, newdata = out_data$week)
write.csv(out_data, "./data/processed/ssc_by_week.csv")
View(data_by_week)
write.csv(out_data, "./data/processed/ssc_by_week.csv", row.names = FALSE)
write.csv(out_data, "./data/processed/ssc_by_week.csv", row.names = FALSE, quote = FALSE)
out_data = tibble("week" = as.numeric(seq(1,53)))
out_data$ssc = predict(loess_mod, newdata = out_data$week)
write.csv(out_data, "./data/processed/ssc_by_week.csv", row.names = FALSE, quote = FALSE)
View(out_data)
View(data)
